{"version":3,"sources":["../../../src/controllers/videos.js"],"names":["uploadsPath","VideosController","req","res","busboy","Busboy","headers","on","fieldname","file","filename","encoding","mimetype","console","log","saveTo","path","join","basename","pipe","fs","createWriteStream","val","fieldnameTruncated","valTruncated","inspect","body","writeHead","end","rs","createReadStream"],"mappings":";;;;;;;;AACA;;;;AACA;;;;AACA;;;;AAGA;;;;;;;;AAIA,IAAMA,cAAc,WAApB;;IAEMC,gB;;;;;;;2CAESC,G,EAAKC,G,EAAI;AAChB,4BAAIC,SAAS,IAAIC,gBAAJ,CAAW,EAACC,SAASJ,IAAII,OAAd,EAAX,CAAb;;AAEAF,+BAAOG,EAAP,CAAU,MAAV,EAAkB,UAACC,SAAD,EAAYC,IAAZ,EAAkBC,QAAlB,EAA4BC,QAA5B,EAAsCC,QAAtC,EAAmD;AACjEC,wCAAQC,GAAR,CAAY,YAAZ;;AAEA,oCAAIC,SAASC,eAAKC,IAAL,CAAUjB,WAAV,EAAuBgB,eAAKE,QAAL,CAAcV,SAAd,IAAyB,MAAhD,CAAb;AACAK,wCAAQC,GAAR,CAAY,gBAAeC,MAA3B;;AAEAN,qCAAKU,IAAL,CAAUC,aAAGC,iBAAH,CAAqBN,MAArB,CAAV;AACH,yBAPD;;AASAX,+BAAOG,EAAP,CAAU,OAAV,EAAmB,UAASC,SAAT,EAAoBc,GAApB,EAAyBC,kBAAzB,EAA6CC,YAA7C,EAA2D;AAC1EX,wCAAQC,GAAR,CAAY,YAAYN,SAAZ,GAAwB,YAAxB,GAAuCiB,QAAQH,GAAR,CAAnD;AACH,yBAFD;;AAIAlB,+BAAOG,EAAP,CAAU,QAAV,EAAoB,YAAW;;AAE3BM,wCAAQC,GAAR,CAAYZ,IAAIwB,IAAhB;;AAEA,oCAAIX,SAASC,eAAKC,IAAL,CAAU,KAAGjB,WAAb,EAA0BgB,eAAKE,QAAL,CAAc,KAAGV,SAAjB,IAA4B,MAAtD,CAAb;AACAK,wCAAQC,GAAR,CAAY,gBAAeC,MAA3B;;AAEAN,qCAAKU,IAAL,CAAUC,aAAGC,iBAAH,CAAqBN,MAArB,CAAV;;AAEAZ,oCAAIwB,SAAJ,CAAc,GAAd,EAAmB,EAAE,cAAc,OAAhB,EAAnB;AACAxB,oCAAIyB,GAAJ,CAAQ,oBAAR;AACH,yBAXD;;AAaA,+BAAO1B,IAAIiB,IAAJ,CAASf,MAAT,CAAP;AACH;;;6CAIYF,G,EAAKC,G,EAAI;AAClBU,gCAAQC,GAAR,CAAY,oBAAZ;;AAEA;;AAEAX,4BAAIwB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,WAAlB,EAAnB;;AAEA,4BAAIE,KAAKT,aAAGU,gBAAH,CAAoB9B,cAAY,UAAhC,CAAT;;AAEA6B,2BAAGV,IAAH,CAAQhB,GAAR;AAGH;;;;;;kBAMUF,gB","file":"videos.js","sourcesContent":["\r\nimport path from 'path';\r\nimport os from 'os';\r\nimport fs from 'fs';\r\n\r\n\r\nimport Busboy from 'busboy';\r\n\r\n\r\n\r\nconst uploadsPath = './uploads';\r\n\r\nclass VideosController {\r\n\r\n    sendVideos(req, res){\r\n        var busboy = new Busboy({headers: req.headers});\r\n\r\n        busboy.on('file', (fieldname, file, filename, encoding, mimetype) => {\r\n            console.log('video ok 0');\r\n\r\n            var saveTo = path.join(uploadsPath, path.basename(fieldname)+'.mp4');\r\n            console.log('video ok 1 ' +saveTo);\r\n\r\n            file.pipe(fs.createWriteStream(saveTo));\r\n        });\r\n\r\n        busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated) {\r\n            console.log('Field [' + fieldname + ']: value: ' + inspect(val));\r\n        });\r\n\r\n        busboy.on('finish', function() {\r\n\r\n            console.log(req.body);\r\n\r\n            var saveTo = path.join(''+uploadsPath, path.basename(''+fieldname)+'.mp4');\r\n            console.log('video ok 1 ' +saveTo);\r\n\r\n            file.pipe(fs.createWriteStream(saveTo));\r\n\r\n            res.writeHead(200, { 'Connection': 'close' });\r\n            res.end(\"That's all folks!!\");\r\n        });    \r\n        \r\n        return req.pipe(busboy);\r\n    }\r\n\r\n\r\n\r\n    streamVideos(req, res){\r\n        console.log('aqui videos stream');\r\n\r\n        //Realizar consulta, encontrar videos\r\n\r\n        res.writeHead(200, { 'Content-Type': 'video/mp4' });\r\n\r\n        var rs = fs.createReadStream(uploadsPath+'/cat.mp4');\r\n        \r\n        rs.pipe(res);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport default VideosController;"]}